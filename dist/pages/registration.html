<div ng-controller="registrationController" class="content clearfix">
    <div class="col-3 fl" ng-show="showMessageRegistration">
        <div class="alert alert-success alert-dismissable">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
            {{successMessage}}
        </div>
    </div>

    <div class="col-3 fl" id="registration">
        <div class="row" cg-busy="{promise:promise,templateUrl:templateUrl,message:message,backdrop:backdrop,delay:delay,minDuration:minDuration}">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">User Registration</h4>
                    </div>
                    <div class="panel-body">
                        <p>* Mandatory</p>

                        <form role="form" name="form">
                            <div class="form-group" ng-class="{'has-error': form.firstName.$error.required && (submitted)}">
                                <label>First Name *</label>
                                <input class="form-control"
                                       placeholder="Enter First Name"
                                       name="firstName"
                                       type="text"
                                       ng-model="user.firstName"
                                       ng-required="true"
                                       ng-minlength="2" 
                                       ng-keyup="$event.keyCode == 13 && registerUser(form, user)"/>
                                <p class="help-block" ng-if="!submitted">Requires Minimum 2 characters</p>
                                <label class="help-block has-error" ng-if="form.firstName.$error.required && (submitted)">First Name is required</label>
                            </div>
                            <div class="form-group">
                                <label>Middle Initial</label>
                                <input class="form-control" placeholder="Enter Middle Initial"
                                       ng-model="user.middleName">
                            </div>
                            <div class="form-group" ng-class="{'has-error': form.firstName.$error.required && (submitted)}">
                                <label>Last Name *</label>
                                <input class="form-control"
                                       placeholder="Enter Last Name"
                                       name="lastName"
                                       type="text"
                                       ng-model="user.lastName"
                                       ng-required="true"
                                       ng-minlength="2"
                                       ng-keyup="$event.keyCode == 13 && registerUser(form, user)">
                                <p class="help-block" ng-if="!submitted">Requires Minimum 2 characters</p>
                                <label class="help-block has-error" ng-if="form.lastName.$error.required && (submitted)">Last Name is required</label>
                            </div>
                            <div class="form-group" ng-class="{'has-error': form.address.$error.required && (submitted)}">
                                <label>Address *</label>
                                <input class="form-control"
                                       placeholder="Enter Address"
                                       name="address"
                                       type="text"
                                       ng-model="user.address"
                                       ng-required="true"
                                       ng-minlength="2"
                                       ng-keyup="$event.keyCode == 13 && registerUser(form, user)">
                                <p class="help-block" ng-if="!submitted">Requires Minimum 2 characters</p>
                                <label class="help-block has-error" ng-if="form.address.$error.required && (submitted)">Address is required</label>
                            </div>
                            <div class="form-group" ng-class="{'has-error': form.city.$error.required && (submitted)}">
                                <label>City *</label>
                                <input class="form-control"
                                       placeholder="Enter City"
                                       name="city"
                                       type="text"
                                       ng-model="user.city"
                                       ng-required="true"
                                       ng-minlength="2"
                                       ng-keyup="$event.keyCode == 13 && registerUser(form, user)">
                                <p class="help-block" ng-if="!submitted">Requires Minimum 2 characters</p>
                                <label class="help-block has-error" ng-if="form.city.$error.required && (submitted)">City is required</label>
                            </div>
                            <div class="form-group" ng-class="{'has-error': form.state.$error.required && (submitted)}">
                                <label>State *</label>
                                <input class="form-control"
                                       placeholder="Enter State"
                                       name="state"
                                       type="text"
                                       ng-model="user.state"
                                       ng-required="true"
                                       ng-minlength="2"
                                       ng-keyup="$event.keyCode == 13 && registerUser(form, user)">
                                <p class="help-block" ng-if="!submitted">Requires Minimum 2 characters</p>
                                <label class="help-block has-error" ng-if="form.state.$error.required && (submitted)">State is required</label>
                            </div>
                            <div class="form-group" ng-class="{'has-error': form.zip.$error.required && (submitted)}">
                                <label>Zip *</label>
                                <input class="form-control"
                                       placeholder="Enter Zip"
                                       name="zip"
                                       type="text"
                                       ng-model="user.zip"
                                       ng-required="true"
                                       ng-minlength="2"
                                       ng-keyup="$event.keyCode == 13 && registerUser(form, user)">
                                <p class="help-block" ng-if="!submitted">Requires Minimum 2 characters</p>
                                <label class="help-block has-error" ng-if="form.state.$error.required && (submitted)">Zip is required</label>
                            </div>
                            <div class="form-group" ng-class="{'has-error': form.email.$error.pattern || form.email.$error.required && (submitted)}">
                                <label>Email *</label>
                                <input class="form-control"
                                       placeholder="E-mail"
                                       name="email"
                                       type="email"
                                       autofocus value=""
                                       ng-model="user.username"
                                       ng-required="true"
                                       ng-pattern="/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/" 
                                       ng-keyup="$event.keyCode == 13 && registerUser(form, user)"/>
                                <label class="help-block" ng-if="form.email.$error.pattern && (submitted)">The Email is invalid</label>
                                <label class="help-block has-error" ng-if="form.email.$error.required && (submitted)">Email is required</label>
                            </div>
                            <div class="form-group" ng-class="{'has-error': form.password.$error.pattern || form.password.$error.required && (submitted)}">
                                <label>Password *</label>
                                <input class="form-control"
                                       placeholder="Password"
                                       name="password"
                                       type="password"
                                       ng-required="true"
                                       ng-model="user.password"
                                       ng-minlength="8"
                                       ng-maxlength="25"
                                       ng-pattern="/^(?=.*\d)(?=.*[a-zA-Z]).{8,25}$/"
                                       ng-keyup="$event.keyCode == 13 && registerUser(form, user)"/>
                                <p class="help-block" ng-if="form.password.$error.required && (!submitted && !form.password.$dirty)">Invalid password. Minimum 8 characters and atleast 1 character and 1 number</p>
                                <label class="help-block has-error" ng-if="form.password.$error.pattern && form.password.$error.minlength && (submitted)">Invalid password. Minimum 8 characters and atleast 1 character and 1 number</label>
                                <label class="help-block has-error" ng-if="form.password.$error.required && (submitted)">Password is required. Minimum 8 characters and atleast 1 character and 1 number</label>
                            </div>
                            <div class="form-group" ng-class="{'has-error': form.confirmPassword.$error.pattern || form.confirmPassword.$error.required && (submitted)}">
                                <label>Confirm Password</label>
                                <input class="form-control"
                                       placeholder="Confirm password"
                                       name="confirmPassword"
                                       type="password"
                                       ng-required="true"
                                       ng-model="user.confirmPassword"
                                       ng-minlength="8"
                                       ng-maxlength="25" 
                                       ng-pattern="getPattern(user)"
                                       ng-keyup="$event.keyCode == 13 && registerUser(form, user)"/>
                                <label class="help-block has-error" ng-if="form.confirmPassword.$error.required && (submitted)">Password is required</label>
                                <label class="help-block has-error" ng-if="(form.password.$dirty && form.confirmPassword.$dirty && form.confirmPassword.$error.pattern && ! form.confirmPassword.$error.required && (submitted))">
                                    Password must match
                                </label>
                            </div>
                            <a class="btn btn-success" ng-click="registerUser(form, user)">Sign Up</a>
                        </form>
                    </div>

                    <div class="panel-footer">
                        Go to <a href="#/login" ui-sref="login">Login</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

